<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contactez SEMPA | Une question, un projet ?</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <style>
        :root {
            --primary: #ffa300; 
            --primary-light: #FFF1EB; --dark: #0F172A; --light: #F8FAFC; --gray: #94A3B8;
            --gray-light: #E2E8F0; --success: #10B981; --error: #EF4444; --warning: #F59E0B; --radius: 12px;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.1); --shadow-md: 0 4px 6px rgba(0,0,0,0.1); --transition: all 0.3s ease;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Inter', sans-serif; background: #f9fafb; color: var(--dark); line-height: 1.6; scroll-behavior: smooth; }
        .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
        .header { background: white; border-radius: var(--radius); box-shadow: var(--shadow-md); padding: 30px; margin-bottom: 24px; text-align: center; }
        .header h1 { font-size: 24px; font-weight: 700; margin-bottom: 8px; }
        .header .subtitle { font-size: 16px; color: #64748B; }
        .progress-container { display: flex; justify-content: center; margin: 30px 0; position: relative; }
        .progress-bar { position: absolute; top: 50%; transform: translateY(-50%); height: 3px; background: var(--gray-light); width: 80%; z-index: 1; }
        .progress-fill { height: 100%; background: var(--primary); transition: var(--transition); width: 0%; }
        .steps-container { display: flex; justify-content: space-between; width: 80%; position: relative; z-index: 2; }
        .step { display: flex; flex-direction: column; align-items: center; }
        .step-number { width: 40px; height: 40px; border-radius: 50%; background: white; color: var(--gray); display: flex; align-items: center; justify-content: center; font-weight: 600; margin-bottom: 8px; border: 2px solid var(--gray-light); transition: var(--transition); }
        .step.active .step-number { background: var(--primary); border-color: var(--primary); color: white; }
        .step-label { font-size: 14px; font-weight: 500; color: var(--gray); transition: var(--transition); }
        .step.active .step-label { color: var(--primary); }
        .form-section { background: white; border-radius: var(--radius); box-shadow: var(--shadow-md); padding: 30px; margin-bottom: 24px; display: none; }
        .form-section.active { display: block; }
        .section-title { font-size: 20px; font-weight: 600; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 1px solid var(--gray-light); }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
        .form-group { margin-bottom: 20px; }
        label { display: block; font-size: 14px; font-weight: 500; margin-bottom: 8px; color: #374151; }
        .required::after { content: " *"; color: var(--error); }
        input, textarea, select { width: 100%; padding: 12px 16px; border: 1px solid #D1D5DB; border-radius: var(--radius); font-size: 16px; background-color: white; }
        input:focus, textarea:focus, select:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(255, 94, 26, 0.1); }
        .button-group { display: flex; justify-content: space-between; margin-top: 32px; gap: 16px; }
        .btn { padding: 14px 28px; border-radius: var(--radius); font-weight: 600; cursor: pointer; border: none; font-size: 16px; transition: var(--transition); }
        .btn:disabled { background-color: var(--gray-light) !important; color: var(--gray) !important; cursor: not-allowed !important; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-secondary { background: var(--gray-light); color: var(--dark); }
        .confirmation { background: white; border-radius: var(--radius); box-shadow: var(--shadow-md); text-align: center; padding: 40px; display: none; }
        .confirmation h2 { font-size: 24px; color: var(--success); }
        .confirmation p { font-size: 16px; color: #64748B; margin-top: 8px; margin-bottom: 24px;}
        .loading { display: none; text-align: center; margin: 20px 0; }
        .spinner { border: 4px solid rgba(0,0,0,0.1); border-radius: 50%; border-top: 4px solid var(--primary); width: 40px; height: 40px; animation: spin 1s linear infinite; margin: auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .summary-card { margin-top: 24px; background: var(--light); border-radius: var(--radius); padding: 24px; border: 1px solid var(--gray-light); }
        .summary-card h3 { margin-bottom: 16px; }
        .summary-item { display: flex; justify-content: space-between; padding: 8px 0; font-size: 14px; }
        .summary-item span:first-child { font-weight: 500; color: #4B5563; }
        .summary-item.message { flex-direction: column; align-items: flex-start; }
        .summary-item.message pre { background: white; padding: 12px; border-radius: 8px; margin-top: 8px; width: 100%; white-space: pre-wrap; word-wrap: break-word; font-family: 'Inter', sans-serif; font-size: 14px; color: var(--dark); }
        .choices-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .choice-card { background: var(--light); border: 2px solid var(--gray-light); border-radius: var(--radius); padding: 24px; text-align: center; cursor: pointer; transition: var(--transition); }
        .choice-card:hover { border-color: var(--primary); transform: translateY(-5px); box-shadow: var(--shadow-md); }
        .choice-card h3 { font-size: 18px; margin-bottom: 8px; color: var(--dark); }
        .choice-card p { font-size: 14px; color: #64748B; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Un projet, une question ? Parlons-en.</h1>
            <p class="subtitle">Nous sommes là pour vous aider. Suivez ces 3 étapes simples pour nous contacter.</p>
            <div class="progress-container">
                <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
                <div class="steps-container">
                    <div class="step active" id="step-indicator-1"><div class="step-number">1</div><div class="step-label">Votre besoin</div></div>
                    <div class="step" id="step-indicator-2"><div class="step-number">2</div><div class="step-label">Vos infos</div></div>
                    <div class="step" id="step-indicator-3"><div class="step-number">3</div><div class="step-label">Validation</div></div>
                </div>
            </div>
        </div>

        <form id="contactForm" onsubmit="event.preventDefault(); submitForm();">
            
            <div class="form-section active" id="section-1-choice">
                <h2 class="section-title">Quel est l'objet de votre demande ?</h2>
                <div class="choices-grid">
                    <div class="choice-card" onclick="selectRequestType('Contact général', 'Demande d\'information')">
                        <h3>Nous contacter</h3>
                        <p>Pour toute question sur nos produits ou pour obtenir des conseils.</p>
                    </div>
                    <div class="choice-card" onclick="selectRequestType('Demander un RDV', 'Prise de rendez-vous commercial')">
                        <h3>Demander un RDV</h3>
                        <p>Échangez avec un commercial de votre secteur pour une démo ou un devis.</p>
                    </div>
                    <div class="choice-card" onclick="selectRequestType('Déjà client', 'Question ou support client')">
                        <h3>Déjà Client SEMPA ?</h3>
                        <p>Pour le suivi de votre matériel, une question ou une suggestion.</p>
                    </div>
                </div>
            </div>

            <div class="form-section" id="section-2-form">
                <h2 class="section-title" id="form-title">Vos informations</h2>
                <div class="form-grid">
                    <div class="form-group"><label for="fullname" class="required">Nom / Société</label><input type="text" id="fullname" required></div>
                    <div class="form-group"><label for="activity" class="required">Votre activité</label><input type="text" id="activity" required></div>
                </div>
                <div class="form-grid">
                    <div class="form-group"><label for="email" class="required">Email</label><input type="email" id="email" required></div>
                    <div class="form-group"><label for="phone" class="required">Téléphone</label><input type="tel" id="phone" required></div>
                </div>
                <div class="form-grid">
                    <div class="form-group"><label for="postalCode">Code Postal</label><input type="text" id="postalCode"></div>
                    <div class="form-group"><label for="city">Ville</label><input type="text" id="city"></div>
                </div>
                <div class="form-group"><label for="message" class="required">Votre message</label><textarea id="message" rows="5" required></textarea></div>
                <div class="button-group">
                    <button type="button" class="btn btn-secondary" onclick="changeStep(1)">Retour</button>
                    <button type="button" class="btn btn-primary" onclick="changeStep(3)">Étape suivante</button>
                </div>
            </div>

            <div class="form-section" id="section-3-summary">
                <h2 class="section-title">Validation de votre demande</h2>
                <div class="summary-card">
                    <h3>Récapitulatif</h3>
                    <div id="finalSummary"></div>
                </div>
                <div class="loading" id="loadingSpinner"><div class="spinner"></div><p>Envoi en cours...</p></div>
                <div class="button-group">
                    <button type="button" class="btn btn-secondary" onclick="changeStep(2)">Modifier</button>
                    <button type="submit" class="btn btn-primary" id="confirmBtn">Envoyer la demande</button>
                </div>
            </div>
            
            <div class="confirmation" id="confirmationScreen">
                <h2>Message envoyé !</h2>
                <p>Merci ! Nous avons bien reçu votre demande et la traiterons dans les plus brefs délais.</p>
                <button type="button" class="btn btn-primary" onclick="location.reload()">Effectuer une nouvelle demande</button>
            </div>
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3.2.0/dist/email.min.js"></script>
    <script>
        const requestData = {
            type: '',
            subject: ''
        };

        function changeStep(targetStep) {
            // Validation simple avant de passer à l'étape suivante
            if (targetStep > 2 && ['fullname', 'activity', 'email', 'phone', 'message'].some(id => !document.getElementById(id).value)) {
                return alert('Veuillez remplir tous les champs obligatoires.');
            }
            
            document.querySelectorAll('.form-section').forEach(el => el.classList.remove('active'));
            document.getElementById(targetStep === 1 ? 'section-1-choice' : (targetStep === 2 ? 'section-2-form' : 'section-3-summary')).classList.add('active');
            
            document.querySelectorAll('.step').forEach(el => el.classList.remove('active'));
            for (let i = 1; i <= targetStep; i++) document.getElementById(`step-indicator-${i}`).classList.add('active');
            
            document.getElementById('progressFill').style.width = `${((targetStep - 1) / 2) * 100}%`;
            window.scrollTo(0, 0);
            
            if (targetStep === 3) updateFinalSummary();
        }
        
        function selectRequestType(type, subject) {
            requestData.type = type;
            requestData.subject = subject;
            document.getElementById('form-title').textContent = `Vos informations - ${type}`;
            changeStep(2);
        }

        function updateFinalSummary() {
            const container = document.getElementById('finalSummary');
            const formData = {
                type: requestData.type,
                fullname: document.getElementById('fullname').value,
                activity: document.getElementById('activity').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                postalCode: document.getElementById('postalCode').value || 'Non fourni',
                city: document.getElementById('city').value || 'Non fournie',
                message: document.getElementById('message').value
            };

            container.innerHTML = `
                <div class="summary-item"><span>Objet de la demande</span><span>${formData.type}</span></div>
                <div class="summary-item"><span>Nom / Société</span><span>${formData.fullname}</span></div>
                <div class="summary-item"><span>Activité</span><span>${formData.activity}</span></div>
                <div class="summary-item"><span>Email</span><span>${formData.email}</span></div>
                <div class="summary-item"><span>Téléphone</span><span>${formData.phone}</span></div>
                <div class="summary-item"><span>Code Postal / Ville</span><span>${formData.postalCode} ${formData.city}</span></div>
                <div class="summary-item message">
                    <span>Message</span>
                    <pre>${formData.message}</pre>
                </div>
            `;
        }
        
        async function submitForm() {
            const confirmBtn = document.getElementById('confirmBtn');
            const spinner = document.getElementById('loadingSpinner');
            
            spinner.style.display = 'block';
            confirmBtn.disabled = true;

            const formData = {
                request_type: requestData.type,
                request_subject: requestData.subject,
                fullname: document.getElementById('fullname').value,
                activity: document.getElementById('activity').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                postalCode: document.getElementById('postalCode').value,
                city: document.getElementById('city').value,
                message: document.getElementById('message').value
            };
            
            try {
                // --- Étape 1: Sauvegarde en base de données (Endpoint WordPress) ---
                const response = await fetch('https://sempa.fr/wp-json/sempa/v1/enregistrer-contact', {
                   method: 'POST',
                   headers: { 'Content-Type': 'application/json' },
                   body: JSON.stringify(formData)
                });
                if (!response.ok) throw new Error(`Erreur serveur: ${response.statusText}`);
                const responseData = await response.json();
                if (!responseData.success) throw new Error(responseData.message || 'Erreur lors de l\'enregistrement.');

                // --- Étape 2: Envoi des emails via EmailJS ---
                emailjs.init("-lhgXim6HQMcjFwy2"); // Public Key intégrée

                const emailParams = {
                    // Paramètres pour les templates email
                    request_subject: formData.request_subject,
                    fullname: formData.fullname,
                    activity: formData.activity,
                    email: formData.email,
                    phone: formData.phone,
                    postalCode: formData.postalCode || 'N/A',
                    city: formData.city || 'N/A',
                    message: formData.message,
                    // Destinataire de l'email admin (vous)
                    to_admin_email: "valerie@sempa.fr"
                };
                
                // Le Service ID est probablement le même que pour votre autre formulaire
                const serviceID = "service_uwe9bco";
                const templateAdminID = "template_zugknjc"; // ID Admin fourni
                const templateClientID = "template_awy05ru"; // ID Client fourni

                // Envoi de l'email de notification pour l'admin
                await emailjs.send(serviceID, templateAdminID, emailParams);
                
                // Envoi de l'email de confirmation pour le client
                await emailjs.send(serviceID, templateClientID, emailParams);

                // --- Étape 3: Affichage de l'écran de confirmation ---
                document.getElementById('contactForm').style.display = 'none';
                document.getElementById('confirmationScreen').style.display = 'block';

            } catch (error) {
                console.error("Erreur de soumission :", error);
                alert("Une erreur est survenue lors de l'envoi de votre message. Veuillez réessayer ou nous contacter directement par téléphone.\n\nDétail de l'erreur : " + error.message);
            } finally {
                spinner.style.display = 'none';
                confirmBtn.disabled = false;
            }
        }
    </script>
</body>
</html>

